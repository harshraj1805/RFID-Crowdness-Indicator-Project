<!DOCTYPE html>
<html>
<head>
    <title>Live Occupancy Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        .progress-container { 
            display: inline-block; 
            position: relative;
            width: 250px; 
            height: 20px; 
            background: #ddd; 
            border: 2px solid black; 
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        .progress-bar { 
            height: 100%; 
            border-radius: 8px;
        }
        .status-message { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Number of Peoples Inside</h1>
    <div class="progress-container">
        <div id="progressBar" class="progress-bar" style="width: 0%; background-color: green;"></div>
    </div>
    <p id="percentage">0%</p>
    <p id="statusMessage" class="status-message">Now you can go there, it's not much crowded!</p>
    <canvas id="entryChart"></canvas>

    <script>
        const API_URL = "https://docs.google.com/spreadsheets/d/1srmt2AA5F_QCiBLcM7lAmo9pln2nhfrW4NnI6OrtfKk/gviz/tq?tqx=out:json";
        const MAX_PEOPLE = 20;

        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                let text = await response.text();
                let json = JSON.parse(text.substring(47, text.length - 2));
                let rows = json.table.rows;

                let totalOccupancy = 0;
                let hourlyData = Array(24).fill(0);

                rows.forEach(row => {
                    let time = row.c[0].v;
                    let value = parseInt(row.c[1].v);
                    totalOccupancy += value;

                    let hours = parseInt(time.split(":" )[0]);
                    hourlyData[hours] += value;
                });

                document.getElementById("percentage").innerText = ((totalOccupancy / MAX_PEOPLE) * 100).toFixed(2) + "%";
                document.getElementById("progressBar").style.width = (totalOccupancy / MAX_PEOPLE) * 100 + "%";
                
                let progressBar = document.getElementById("progressBar");
                let statusMessage = document.getElementById("statusMessage");
                let occupancyPercentage = (totalOccupancy / MAX_PEOPLE) * 100;
                
                if (occupancyPercentage < 50) {
                    progressBar.style.backgroundColor = "green";
                    statusMessage.innerText = "Now you can go there, it's not much crowded!";
                } else if (occupancyPercentage < 80) {
                    progressBar.style.backgroundColor = "yellow";
                    statusMessage.innerText = "It's getting crowded, consider going later!";
                } else {
                    progressBar.style.backgroundColor = "red";
                    statusMessage.innerText = "Too crowded! Try at another time.";
                }

                updateChart(hourlyData);
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        function updateChart(data) {
            const ctx = document.getElementById("entryChart").getContext("2d");
            new Chart(ctx, {
                type: "bar",
                data: {
                    labels: Array.from({ length: 24 }, (_, i) => `${i.toString().padStart(2, '0')}:00-${(i + 1).toString().padStart(2, '0')}:00`),
                    datasets: [{
                        label: "Total Entries Per Hour",
                        data: data,
                        backgroundColor: "blue"
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            suggestedMax: Math.max(...data) + 2
                        }
                    }
                }
            });
        }

        setInterval(fetchData, 60000);
        fetchData();
    </script>
</body>
</html>





